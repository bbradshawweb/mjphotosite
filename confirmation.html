<!DOCTYPE html>
<html lang="en">
<head>
  <title>Confirmed | Mallory Jane Photography</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" type="image/png" href="assets/brand/favicon.png">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
  <link rel="stylesheet" href="site.css">
</head>
<body>

<!-- Top nav -->
<div class="w3-bar w3-white w3-padding w3-card">
  <a href="index.html" class="w3-bar-item w3-button w3-padding-small">
    <img src="assets/brand/logo.png" alt="Mallory Jane Photography" style="height:28px;vertical-align:middle;">
  </a>

  <div class="w3-right w3-hide-small">
    <a href="index.html" class="w3-bar-item w3-button">Home</a>
    <a href="packages.html" class="w3-bar-item w3-button">Packages</a>
    <a href="book.html" class="w3-bar-item w3-button w3-light-grey w3-round">Book</a>
  </div>
</div>

<!-- Mobile nav -->
<div class="w3-bar w3-light-grey w3-hide-medium w3-hide-large">
  <a href="index.html" class="w3-bar-item w3-button">Home</a>
  <a href="packages.html" class="w3-bar-item w3-button">Packages</a>
  <a href="book.html" class="w3-bar-item w3-button w3-light-grey">Book</a>
</div>

<div class="w3-content w3-padding-large w3-margin-top" style="max-width:900px">
  <div class="w3-card w3-round w3-padding-large">
    <h2 class="w3-center mj-section-title">Youâ€™re Booked ðŸŽ‰</h2>
    <p class="w3-center w3-text-grey">
      A confirmation email should arrive shortly with your exact time/location details.
      If you donâ€™t see it, check spam/junk.
    </p>

    <hr>

    <h3 class="mj-section-title">Booking details</h3>

    <div class="w3-responsive">
      <table class="w3-table w3-bordered">
        <tr>
          <td><b>Package</b></td>
          <td id="detail-package">â€”</td>
        </tr>
        <tr>
          <td><b>Name</b></td>
          <td id="detail-name">â€”</td>
        </tr>
        <tr>
          <td><b>Email</b></td>
          <td id="detail-email">â€”</td>
        </tr>
        <tr>
          <td><b>Date / Time</b></td>
          <td id="detail-datetime">â€”</td>
        </tr>
        <tr>
          <td><b>Timezone</b></td>
          <td id="detail-timezone">â€”</td>
        </tr>
      </table>
    </div>

    <p class="w3-text-grey w3-small w3-margin-top" id="detail-note"></p>

    <!-- PAYMENT INFO SECTION -->
    <div class="w3-light-grey w3-round w3-padding w3-margin-top">
      <h3 class="mj-section-title">Payment</h3>

      <p id="payment-copy" class="w3-large" style="margin-top:0;"></p>

      <div class="w3-row-padding w3-margin-top">
        <div class="w3-col m6 s12 w3-center w3-margin-bottom">
          <a href="https://venmo.com/u/malbradshaw08" target="_blank" rel="noopener" aria-label="Pay on Venmo">
            <img src="assets/brand/MalVenmo.png" alt="Venmo QR Code" class="w3-image w3-round" style="max-width:320px;">
          </a>
          <p class="w3-small w3-text-grey" style="margin-top:8px;">Tap the QR code to open Venmo</p>
        </div>

        <div class="w3-col m6 s12">
          <p><b>Venmo link:</b></p>
          <p>
            <a href="https://venmo.com/u/malbradshaw08" target="_blank" rel="noopener">
              venmo.com/u/malbradshaw08
            </a>
          </p>

          <div class="w3-margin-top">
            <a class="w3-button w3-dark-grey w3-round" href="https://venmo.com/u/malbradshaw08" target="_blank" rel="noopener">
              Pay on Venmo
            </a>
          </div>

          <p class="w3-text-grey w3-small w3-margin-top">
            If you prefer another payment method, just reply to my email/text and weâ€™ll make it easy.
          </p>
        </div>
      </div>
    </div>

    <div class="w3-center w3-margin-top">
      <a href="packages.html" class="w3-button w3-light-grey w3-round w3-margin-right">View Packages</a>
      <a href="index.html" class="w3-button w3-dark-grey w3-round">Back Home</a>
    </div>
  </div>
</div>

<!-- CONTACT FOOTER -->
<footer class="w3-container w3-dark-grey w3-center w3-padding-32 mj-footer">
  <h3 class="mj-section-title">Contact Me</h3>
  <p>
    <a class="w3-text-white" href="mailto:mal.jane.photography@gmail.com">mal.jane.photography@gmail.com</a>
  </p>

  <div class="mj-social">
    <a href="https://www.facebook.com/profile.php?id=61570271263678" target="_blank" rel="noopener" aria-label="Facebook">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.5A3.5 3.5 0 0 1 14.2 6h2.3v3h-2.3c-.7 0-1.2.6-1.2 1.3V12H17l-.5 3h-3v7A10 10 0 0 0 22 12z"/>
      </svg>
    </a>

    <a href="https://www.instagram.com/mallory.jane_photography/" target="_blank" rel="noopener" aria-label="Instagram">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4.5A5.5 5.5 0 1 1 6.5 12 5.5 5.5 0 0 1 12 8.5zm0 2A3.5 3.5 0 1 0 15.5 12 3.5 3.5 0 0 0 12 10.5zM18 6.8a1.2 1.2 0 1 1-1.2 1.2A1.2 1.2 0 0 1 18 6.8z"/>
      </svg>
    </a>
  </div>
</footer>

<script>
  // Booking question identifier (case-sensitive) from Cal
  const PACKAGE_FIELD_IDENTIFIER = "Package";
  const qs = new URLSearchParams(window.location.search);

  // Package: prefer query param; fallback to localStorage (set in book.html)
  const pkgFromQuery = qs.get(PACKAGE_FIELD_IDENTIFIER);
  let pkg = pkgFromQuery;
  let pkgKey = null;

  try {
    if (!pkg) pkg = localStorage.getItem("mj_selected_package_label");
    pkgKey = localStorage.getItem("mj_selected_package_key");
  } catch (e) {}

  // Try to capture common booking detail params (Cal may or may not forward them)
  const name =
    qs.get("name") ||
    qs.get("fullName") ||
    qs.get("attendeeName") ||
    "";

  const email =
    qs.get("email") ||
    qs.get("attendeeEmail") ||
    "";

  const tz =
    qs.get("timezone") ||
    qs.get("tz") ||
    "";

  const startRaw =
    qs.get("startDate") ||
    qs.get("startTime") ||
    qs.get("start") ||
    "";

  function formatDateTime(raw) {
    if (!raw) return "";
    const d = new Date(raw);
    if (isNaN(d.getTime())) return raw;
    return d.toLocaleString(undefined, { dateStyle: "full", timeStyle: "short" });
  }

  document.getElementById("detail-package").textContent = pkg || "â€”";
  document.getElementById("detail-name").textContent = name || "â€”";
  document.getElementById("detail-email").textContent = email || "â€”";
  document.getElementById("detail-datetime").textContent = formatDateTime(startRaw) || "â€”";
  document.getElementById("detail-timezone").textContent = tz || "â€”";

  const noteEl = document.getElementById("detail-note");
  if (!pkgFromQuery && !name && !email && !startRaw) {
    noteEl.textContent =
      "Note: Some booking details may only appear in your confirmation email (depending on what Cal forwards on redirect).";
  } else {
    noteEl.textContent = "";
  }

  // --- Payment copy with dynamic package price ---
  const PRICE_BY_KEY = {
    "carnation": 150,
    "peony": 200,
    "iris": 250,
    "lily": 350,
    "orchid": 575,
    "headshots": 150,
    "special-event": null
  };

  // If we don't have a key (only a label), infer it from the label text
  function inferKeyFromLabel(label) {
    if (!label) return null;
    const s = label.toLowerCase();
    if (s.includes("carnation")) return "carnation";
    if (s.includes("peony")) return "peony";
    if (s.includes("iris")) return "iris";
    if (s.includes("lily")) return "lily";
    if (s.includes("orchid")) return "orchid";
    if (s.includes("headshot")) return "headshots";
    if (s.includes("special") || s.includes("dance") || s.includes("event")) return "special-event";
    return null;
  }

  const resolvedKey = pkgKey || inferKeyFromLabel(pkg);
  const price = resolvedKey ? PRICE_BY_KEY[resolvedKey] : null;

  function money(n) {
    return typeof n === "number" ? `$${n.toFixed(0)}` : "";
  }

  const paymentEl = document.getElementById("payment-copy");

  const baseTextStart =
    "Congrats on your booking! I will be in touch regarding details. We can chat there about any questions you have or details for your booking. ";

  const pricingSentenceStandard =
    `Your total without any add-ons is ${money(price)}. `;

  const pricingSentenceCustom =
    "Your total without any add-ons will be confirmed with you by quote. ";

  const baseTextEnd =
    "This won't be due until the time of your event. The standard practice is half before the pictures are taken, half when the pictures are received, but I am a real person and things happen! For now, focus on the hard parts: getting your outfits together and getting excited! Keep a look out for my email/text!";

  // If special event OR missing price, use custom sentence
  const useCustom = (resolvedKey === "special-event") || (price === null);

  paymentEl.textContent =
    baseTextStart +
    (useCustom ? pricingSentenceCustom : pricingSentenceStandard) +
    baseTextEnd;
</script>

</body>
</html>
