<!DOCTYPE html>
<html lang="en">
<head>
  <title>Book | Mallory Jane Photography</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" type="image/png" href="assets/brand/favicon.png">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
</head>
<body>

<!-- Top nav -->
<div class="w3-bar w3-white w3-padding w3-card">
  <a href="index.html" class="w3-bar-item w3-button w3-padding-small">
    <img src="assets/brand/logo.png" alt="Mallory Jane Photography" style="height:28px;vertical-align:middle;">
  </a>

  <div class="w3-right w3-hide-small">
    <a href="index.html" class="w3-bar-item w3-button">Home</a>
    <a href="packages.html" class="w3-bar-item w3-button">Packages</a>
    <a href="book.html" class="w3-bar-item w3-button w3-light-grey w3-round">Book</a>
  </div>
</div>

<!-- Mobile nav -->
<div class="w3-bar w3-light-grey w3-hide-medium w3-hide-large">
  <a href="index.html" class="w3-bar-item w3-button">Home</a>
  <a href="packages.html" class="w3-bar-item w3-button">Packages</a>
  <a href="book.html" class="w3-bar-item w3-button w3-light-grey">Book</a>
</div>

<div class="w3-content w3-padding-large w3-margin-top" style="max-width:1100px">
  <h2 class="w3-center">Book a Session</h2>
  <p class="w3-center w3-text-grey">Choose a package to see matching time slots.</p>

  <div class="w3-center w3-margin-bottom">
    <div class="w3-bar w3-light-grey w3-round">
      <button class="w3-bar-item w3-button" onclick="selectPackage('carnation')">Carnation</button>
      <button class="w3-bar-item w3-button" onclick="selectPackage('peony')">Peony</button>
      <button class="w3-bar-item w3-button" onclick="selectPackage('iris')">Iris</button>
      <button class="w3-bar-item w3-button" onclick="selectPackage('lily')">Lily</button>
      <button class="w3-bar-item w3-button" onclick="selectPackage('orchid')">Orchid</button>
      <button class="w3-bar-item w3-button" onclick="selectPackage('headshots')">Headshots</button>
      <button class="w3-bar-item w3-button" onclick="selectPackage('special-event')">Special Event</button>
    </div>
  </div>

  <div id="cal-inline" class="w3-card w3-round" style="width:100%; height:900px; overflow:scroll;"></div>

  <p class="w3-center w3-text-grey w3-small w3-margin-top">
    If you don’t see a time that works, please email
    <a href="mailto:hello@malloryjanephotography.com">hello@malloryjanephotography.com</a>.
  </p>
</div>

<!-- Cal embed loader (only once) -->
<script type="text/javascript">
  (function (C, A, L) {
    let p = function (a, ar) { a.q.push(ar); };
    let d = C.document;
    C.Cal = C.Cal || function () {
      let cal = C.Cal;
      let ar = arguments;
      if (!cal.loaded) {
        cal.ns = {};
        cal.q = cal.q || [];
        d.head.appendChild(d.createElement("script")).src = A;
        cal.loaded = true;
      }
      if (ar[0] === L) {
        const api = function () { p(api, arguments); };
        const namespace = ar[1];
        api.q = api.q || [];
        if (typeof namespace === "string") {
          cal.ns[namespace] = cal.ns[namespace] || api;
          p(cal.ns[namespace], ar);
          p(cal, ["initNamespace", namespace]);
        } else p(cal, ar);
        return;
      }
      p(cal, ar);
    };
  })(window, "https://app.cal.com/embed/embed.js", "init");

  Cal("init", { origin: "https://app.cal.com" });
</script>

<script type="text/javascript">
  const PACKAGE_FIELD_IDENTIFIER = "Package";

  const CAL_EVENT = {
    min30: "mallory-jane-photo/30min",
    min45: "mallory-jane-photo/45min",
    min60: "mallory-jane-photo/60-minute-session",
    min90: "mallory-jane-photo/90-minute-session"
  };

  const PACKAGES = {
    carnation:     { label: "CARNATION PACKAGE", calBase: CAL_EVENT.min30 },
    headshots:     { label: "HEADSHOTS PACKAGE", calBase: CAL_EVENT.min30 },

    peony:         { label: "PEONY PACKAGE", calBase: CAL_EVENT.min45 },

    iris:          { label: "IRIS PACKAGE", calBase: CAL_EVENT.min60 },

    lily:          { label: "LILY PACKAGE", calBase: CAL_EVENT.min90 },
    orchid:        { label: "ORCHID PACKAGE (Proposal / Milestone)", calBase: CAL_EVENT.min90 },

    "special-event": { label: "SPECIAL EVENT (Dance Package) — Quote", calBase: CAL_EVENT.min90 }
  };

  function renderCal(calBase, packageLabel) {
    const el = document.querySelector("#cal-inline");
    el.innerHTML = "";

    Cal("inline", {
      elementOrSelector: "#cal-inline",
      calLink: calBase,
      config: {
        layout: "month_view",
        [PACKAGE_FIELD_IDENTIFIER]: packageLabel
      }
    });

    Cal("ui", { hideEventTypeDetails: false, layout: "month_view" });
  }

  function highlightSelected(pkgKey) {
    document.querySelectorAll(".w3-bar button.w3-button").forEach(btn => btn.classList.remove("w3-dark-grey"));
    const order = ["carnation","peony","iris","lily","orchid","headshots","special-event"];
    const idx = order.indexOf(pkgKey);
    const buttons = document.querySelectorAll(".w3-bar button.w3-button");
    if (idx >= 0 && buttons[idx]) buttons[idx].classList.add("w3-dark-grey");
  }

  function selectPackage(pkgKey) {
    const pkg = PACKAGES[pkgKey];
    if (!pkg) return;

    window.location.hash = pkgKey;

    try {
      localStorage.setItem("mj_selected_package_key", pkgKey);
      localStorage.setItem("mj_selected_package_label", pkg.label);
    } catch (e) {}

    highlightSelected(pkgKey);
    renderCal(pkg.calBase, pkg.label);
  }

  window.addEventListener("load", () => {
    const pkgKey = (window.location.hash || "#carnation").replace("#", "");
    selectPackage(PACKAGES[pkgKey] ? pkgKey : "carnation");
  });
</script>

</body>
</html>
